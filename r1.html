<!doctype html><html><head>

    <!-- Meta data stuff -->
    <meta charset="utf-8" />
    <title>experiment 6</title>
    <script src="utils.js"></script>
    <script src="display.js"></script>
    <script src="entities.js"></script>

</head><body>
<div>
    <button onclick="start()">start</button>
    <button onclick="stop()">stop</button>
</div>
<script>

///////////
// Declarations

    var WIDTH = 400;
    var HEIGHT = 300;

    var display;
    var entities;
    var animating;

    function createDisplay() {

        display = getDisplay(WIDTH, HEIGHT);

    }

    function createEntities(amount) {

        entities = getEntities(amount);

    }

    function positionEntities() {

        var entity;

        var i = 0;
        var n = entities.length;

        for ( i; i < n; i += 1 ) {

            entity = entities[i];

            entity.x = generateRandomNumber(0, WIDTH);
            entity.y = generateRandomNumber(0, HEIGHT);

        }

    }

    function load() {

        createDisplay();
        createEntities(10);
        positionEntities();

    }

// ----

    function getRandomDirection() {

        var heading;
        var direction;

        heading = Math.random() * (Math.PI * 2);

        direction = {x: Math.cos(heading), y: Math.sin(heading)};

        return direction;

    }

    function moveEntity(entity) {

        var direction;

        direction = getRandomDirection();

        entity.x += entity.speed * direction.x;
        entity.y += entity.speed * direction.y;

    }

    function updateEntities(p_entities) {

        var entity;

        var i = 0;
        var n = p_entities.length;

        for ( i; i < n; i += 1 ) {

            entity = p_entities[i];

            moveEntity(entity);

        }

    }

    function isOutOfBounds(entity) {

        return ( entity.x < 0 || entity.x > WIDTH || entity.y < 0 || entity.y > HEIGHT );

    }

    function kill(entity) {

        entity.status = 0;

    }

    function updateEntitiesDamage(p_entities) {

        var entity;

        var i = 0;
        var n = p_entities.length;

        for ( i; i < n; i += 1 ) {

            entity = p_entities[i];

            if (isOutOfBounds(entity)) {
                kill(entity);
            }

        }

    }

    function getAliveEntities(p_entities) {

        var entities;
        var entity;

        var entities = [];

        var i = 0;
        var n = p_entities.length;

        for ( i; i < n; i += 1 ) {

            entity = p_entities[i];

            if (entity.status !== 0) {
                entities.push(entity);
            }

        }

        return entities;

    }

    function updateValues() {

        updateEntities(entities);

        updateEntitiesDamage(entities);

        entities = getAliveEntities(entities);

    }

// ----

    function drawBackground() {

        display.fill("rgba(15, 15, 15, 1)");

    }

    function drawEntity(entity) {

        display.drawRect(
            entity.x - 2,
            entity.y - 2,
            4,
            4,
            entity.color
        )

    }

    function drawEntities(p_entities) {

        var entity;

        var i = 0;
        var n = p_entities.length;

        for ( i; i < n; i += 1 ) {

            entity = p_entities[i];

            drawEntity(entity);

        }

    }

    function updateDisplay() {

        drawBackground();

        drawEntities(entities);

    }

    function tic() {

        updateValues();

        updateDisplay();

        if (animating === true) {

            window.requestAnimationFrame(tic);

        }

    }

    function start() {

        if (animating === true) {

            return;

        }

        animating = true;

        tic();

    }

    function stop() {

        animating = false;

    }

///////////
// Execution

    load();

</script></body></html>
